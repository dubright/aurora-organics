<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aurora Organics üåø</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: "Inter", sans-serif;
      background: linear-gradient(180deg, #0c0f11 0%, #0f1115 100%);
      color: #e6e6e6; height: 100vh; display: flex; overflow: hidden;
    }
    aside {
      width: 240px;
      background: linear-gradient(180deg, #111315 0%, #0c0f11 100%);
      border-right: 1px solid #1c1f22;
      padding: 1.5rem;
      display: flex; flex-direction: column; gap: 1rem;
      box-shadow: inset -1px 0 10px rgba(0,230,118,.05);
    }
    aside h1 {
      font-size: 1.3rem;
      color: #00e676;
      display: flex; align-items: center; gap: 8px;
      text-shadow: 0 0 6px rgba(0,230,118,.6);
    }
    .nav-btn {
      background: none; border: none; color: #e6e6e6;
      font-size: 1rem; text-align: left;
      padding: 10px; border-radius: 8px; cursor: pointer; transition: .3s;
    }
    .nav-btn.active, .nav-btn:hover {
      background: rgba(0,230,118,.08);
      color: #00e676; font-weight: 600;
    }
    main { flex: 1; display: flex; overflow: hidden; }
    .content {
      flex: 1; padding: 2rem; overflow-y: auto;
      background: radial-gradient(circle at top left, rgba(0,230,118,.08), transparent 60%);
    }
    .sidebar-right {
      width: 320px;
      background: linear-gradient(180deg, #121417 0%, #0f1115 100%);
      border-left: 1px solid #1d1f23;
      padding: 1.2rem; overflow-y: auto;
    }
    h2 {
      color: #00e676; font-size: 1.3rem; font-weight: 700;
      display: flex; align-items: center; gap: 8px;
      margin-bottom: 1rem; text-shadow: 0 0 6px rgba(0,230,118,.5);
    }
    .card {
      background: rgba(23,26,31,.95);
      border-radius: 12px; padding: 1.2rem 1.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 4px 20px rgba(0,230,118,.05);
      transition: .2s;
    }
    .card:hover { transform: translateY(-2px); }
    select, input, button {
      border: none; border-radius: 8px; padding: 8px 10px;
      font-family: inherit;
    }
    input, select { background: #1b1e22; color: #e6e6e6; }
    button.action {
      background: #00e676; color: #000; font-weight: 600;
      cursor: pointer; transition: .3s;
    }
    button.action:hover { transform: scale(1.05); }
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem; margin-bottom: 1.5rem;
    }
    .metric-card {
      background: #121417;
      border: 1px solid rgba(0,230,118,.15);
      border-radius: 10px; padding: 1rem; text-align: left;
      box-shadow: 0 0 20px rgba(0,230,118,.03);
    }
    .metric-card h3 { color: #e6e6e6; font-size: 1rem; margin-bottom: .4rem; }
    .metric-value {
      color: #00e676; font-weight: 700; font-size: 1.1rem;
      text-shadow: 0 0 8px rgba(0,230,118,.6);
    }
    .progress {
      height: 8px; background: #1f2329;
      border-radius: 4px; overflow: hidden; margin-top: 6px;
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #00e676, #00b050);
      box-shadow: 0 0 8px rgba(0,230,118,.5);
      transition: width .6s ease;
    }
    .alert {
      background: rgba(255,51,51,.1);
      border: 1px solid rgba(255,51,51,.3);
      border-left: 4px solid #ff5252;
      color: #ff7b7b;
      padding: 10px; border-radius: 6px;
      font-size: .9rem; margin-top: 10px;
    }
    .section-title {
      font-weight: 600; color: #00e676;
      margin-top: 1rem; margin-bottom: .5rem;
      font-size: 1.1rem;
    }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-thumb { background: #00e67633; border-radius: 8px; }
    ::-webkit-scrollbar-thumb:hover { background: #00e67666; }
  </style>
</head>
<body>
  <aside>
    <h1>üåø Aurora</h1>
    <button class="nav-btn active" data-page="dashboard">Dashboard</button>
    <button class="nav-btn" data-page="projects">Projetos</button>
  </aside>

  <main>
    <div class="content" id="root"></div>
    <div class="sidebar-right" id="insightsPanel">
      <h2>üìä Insights Inteligentes</h2>
      <div id="insights"></div>
    </div>
  </main>
  <script type="text/babel">
const { useState, useEffect } = React;

const plantas = [
  "Tomate üçÖ", "Alface ü•¨", "Cenoura ü•ï", "R√∫cula üåø",
  "Abobrinha", "Ab√≥bora üéÉ", "Piment√£o üå∂Ô∏è", "Couve ü•¨", "Espinafre üå±"
];

const fases = [
  { nome:"Germina√ß√£o", icone:"üå±", cor:"#00ff99", dias:[0,7]},
  { nome:"Crescimento", icone:"üåø", cor:"#00e676", dias:[8,35]},
  { nome:"Flora√ß√£o", icone:"üå∏", cor:"#c084fc", dias:[36,50]},
  { nome:"Pr√©-colheita", icone:"üçÖ", cor:"#fca311", dias:[51,60]},
  { nome:"Colheita", icone:"üåæ", cor:"#fca903", dias:[61,90]}
];

const formatDate = d => new Date(d).toLocaleDateString("pt-BR",{day:"2-digit",month:"short"});
const getFase = dias => fases.find(f=>dias>=f.dias[0] && dias<=f.dias[1]) || fases[0];
const calcularDosagem = l => {
  const ml = parseFloat(l);
  if (isNaN(ml)) return "100ml";
  if (ml <= 700) return "100ml";
  if (ml <= 2000) return "250ml";
  if (ml <= 5000) return "400ml";
  if (ml <= 10000) return "600ml";
  return "1L";
};

function App({ page }) {
  const [projects, setProjects] = useState(JSON.parse(localStorage.getItem("projectsAurora") || "[]"));
  const [toast, setToast] = useState("");
  const [expanded, setExpanded] = useState(null);

  useEffect(() => localStorage.setItem("projectsAurora", JSON.stringify(projects)), [projects]);
  const showToast = msg => { setToast(msg); setTimeout(() => setToast(""), 2500); };

  // === A√á√ïES DE PROJETO ===
  const addProject = nome => {
    if (!nome.trim()) return alert("Informe um nome para o projeto.");
    const novo = { id: Date.now(), nome, dataCriacao: new Date().toLocaleDateString(), cultivos: [] };
    setProjects([...projects, novo]);
    showToast("üåø Projeto criado!");
  };
  const deleteProject = id => {
    if (confirm("Excluir este projeto?")) {
      setProjects(projects.filter(p => p.id !== id));
      if (expanded === id) setExpanded(null);
      showToast("üóëÔ∏è Projeto removido.");
    }
  };

  // === A√á√ïES DE CULTIVO ===
  const addCultivo = (projId, form) => {
    const dataGerminacao = new Date(form.data);
    const novasTarefas = [];
    for (let i = 0; i < 60; i += 3) {
      const dataT = new Date(dataGerminacao);
      dataT.setDate(dataT.getDate() + i);
      const tipo = (i % 15 === 0 && i !== 0) ? "fertilizante" : "√°gua";
      novasTarefas.push({ tipo, data: dataT.toISOString(), dosagem: calcularDosagem(form.litragem), concluida: false });
    }

    const novo = {
      id: Date.now(),
      planta: form.planta,
      data: form.data,
      litragem: form.litragem,
      quantidade: form.quantidade,
      altura: 0,
      folhas: 0,
      pragas: "",
      produtividade: 0,
      custo: 0,
      tarefas: novasTarefas
    };
    setProjects(projects.map(p => p.id === projId ? { ...p, cultivos: [...p.cultivos, novo] } : p));
    showToast("üå± Cultivo adicionado!");
  };

  const atualizarCultivo = (projId, cultId, campo, valor) => {
    setProjects(projects.map(p => p.id === projId
      ? { ...p, cultivos: p.cultivos.map(c => c.id === cultId ? { ...c, [campo]: valor } : c) }
      : p
    ));
  };

  const concluirTarefa = (projId, cultId, index) => {
    setProjects(projects.map(p =>
      p.id === projId
        ? { ...p, cultivos: p.cultivos.map(c =>
          c.id === cultId ? { ...c, tarefas: c.tarefas.map((t, i) => i === index ? { ...t, concluida: true } : t) } : c
        ) }
        : p
    ));
    showToast("‚úÖ Tarefa conclu√≠da!");
  };

  // === COMPONENTE DE PROJETOS ===
  function Projetos() {
    const [nome, setNome] = useState("");
    const [form, setForm] = useState({ planta:"", data:"", litragem:"700ml", quantidade:1 });

    return (
      <>
        <h2>üåø Projetos</h2>
        <div style={{ display:"flex", gap:"10px", marginBottom:"1rem" }}>
          <input placeholder="Nome do Projeto" value={nome} onChange={e=>setNome(e.target.value)} />
          <button className="action" onClick={()=>{ addProject(nome); setNome(""); }}>+ Novo Projeto</button>
        </div>

        {projects.map(p => (
          <div key={p.id} className="card">
            <div style={{ display:"flex", justifyContent:"space-between" }}>
              <div>
                <strong>{p.nome}</strong>
                <div className="small">{p.cultivos.length} cultivos ‚Ä¢ criado em {p.dataCriacao}</div>
              </div>
              <div style={{ display:"flex", gap:"8px" }}>
                <button className="action" onClick={()=>setExpanded(expanded===p.id?null:p.id)}>{expanded===p.id?"Fechar":"Abrir"}</button>
                <button className="action" onClick={()=>deleteProject(p.id)}>Excluir</button>
              </div>
            </div>
            {expanded === p.id && (
              <div style={{ marginTop:"1rem" }}>
                <div style={{ display:"flex", gap:"8px", marginBottom:"1rem" }}>
                  <select value={form.planta} onChange={e=>setForm({...form,planta:e.target.value})}>
                    <option value="">Planta</option>
                    {plantas.map(pl => <option key={pl}>{pl}</option>)}
                  </select>
                  <input type="date" value={form.data} onChange={e=>setForm({...form,data:e.target.value})}/>
                  <select value={form.litragem} onChange={e=>setForm({...form,litragem:e.target.value})}>
                    <option>700ml</option><option>2L</option><option>5L</option><option>10L</option><option>15L</option>
                  </select>
                  <input type="number" min="1" value={form.quantidade} onChange={e=>setForm({...form,quantidade:e.target.value})}/>
                  <button className="action" onClick={()=>addCultivo(p.id,form)}>Adicionar</button>
                </div>

                {p.cultivos.map(c => {
                  const dias = Math.floor((new Date() - new Date(c.data)) / (1000*60*60*24));
                  const fase = getFase(dias);
                  const tarefasPendentes = c.tarefas.filter(t => !t.concluida);
                  const tarefasProximas = tarefasPendentes.filter(t => {
                    const diasRest = Math.floor((new Date(t.data) - new Date()) / (1000*60*60*24));
                    return diasRest <= 5 && diasRest >= 0;
                  });
                  const eficiencia = c.produtividade && c.custo ? ((c.produtividade - c.custo) / c.custo * 100).toFixed(1) : 0;

                  return (
                    <div key={c.id} className="card">
                      <div style={{ display:"flex", justifyContent:"space-between", alignItems:"center" }}>
                        <strong>{c.planta}</strong>
                        <span>{fase.icone} {fase.nome}</span>
                      </div>
                      <div className="small">Germina√ß√£o: {formatDate(c.data)} ‚Ä¢ Litragem: {c.litragem} ‚Ä¢ Qtd: {c.quantidade}</div>

                      <div className="progress">
                        <div className="progress-bar" style={{ width:`${(dias/60)*100}%` }}></div>
                      </div>

                      {tarefasProximas.length>0 && (
                        <div className="alert">
                          ‚ö†Ô∏è Tarefas pr√≥ximas ({tarefasProximas.length}):
                          {tarefasProximas.map((t,i)=>(
                            <div key={i}>‚Ä¢ {t.tipo} ‚Äî {t.dosagem} ‚Äî {formatDate(t.data)}</div>
                          ))}
                        </div>
                      )}

                      <div className="section-title">üå± Desenvolvimento</div>
                      <div style={{ display:"grid", gridTemplateColumns:"repeat(auto-fit, minmax(140px, 1fr))", gap:"10px" }}>
                        <label>Altura (cm)
                          <input type="number" value={c.altura} onChange={e=>atualizarCultivo(p.id,c.id,"altura",e.target.value)}/>
                        </label>
                        <label>Folhas
                          <input type="number" value={c.folhas} onChange={e=>atualizarCultivo(p.id,c.id,"folhas",e.target.value)}/>
                        </label>
                        <label>Produtividade (g)
                          <input type="number" value={c.produtividade} onChange={e=>atualizarCultivo(p.id,c.id,"produtividade",e.target.value)}/>
                        </label>
                        <label>Custo (R$)
                          <input type="number" value={c.custo} onChange={e=>atualizarCultivo(p.id,c.id,"custo",e.target.value)}/>
                        </label>
                      </div>

                      <div className="section-title">üêõ Pragas e Ocorr√™ncias</div>
                      <textarea
                        rows="2"
                        placeholder="Descreva pragas, doen√ßas ou defici√™ncias observadas..."
                        style={{ width:"100%", background:"#1b1e22", color:"#e6e6e6", borderRadius:"8px", padding:"8px", marginTop:"4px" }}
                        value={c.pragas}
                        onChange={e=>atualizarCultivo(p.id,c.id,"pragas",e.target.value)}
                      ></textarea>

                      <div className="section-title">‚öôÔ∏è Efici√™ncia Agron√¥mica</div>
                      <div style={{ display:"flex", gap:"10px", alignItems:"center" }}>
                        <div className="metric-value">{eficiencia}%</div>
                        {eficiencia < 0 && <span style={{color:"#ff5252"}}>üö® Preju√≠zo</span>}
                        {eficiencia > 0 && <span style={{color:"#00e676"}}>‚úÖ Lucro</span>}
                      </div>

                      <div style={{ marginTop:"10px" }}>
                        <strong>üìã Tarefas a Executar</strong>
                        {tarefasPendentes.length===0 && <div className="small">Tudo conclu√≠do!</div>}
                        {tarefasPendentes.slice(0,5).map((t,i)=>(
                          <div key={i} style={{ display:"flex", justifyContent:"space-between", alignItems:"center", background:"#1b1e22", padding:"6px 10px", borderRadius:"6px", marginTop:"5px" }}>
                            <span>{formatDate(t.data)} ‚Äî üíß {t.tipo} ({t.dosagem})</span>
                            <button className="action" style={{ padding:"4px 8px", fontSize:".8rem" }} onClick={()=>concluirTarefa(p.id,c.id,i)}>Concluir</button>
                          </div>
                        ))}
                      </div>
                    </div>
                  );
                })}
              </div>
            )}
          </div>
        ))}
      </>
    );
  }

  // === DASHBOARD ===
  function Dashboard() {
    const todosCultivos = projects.flatMap(p=>p.cultivos);
    const totalPlantas = todosCultivos.length;
    const totalTarefas = todosCultivos.flatMap(c=>c.tarefas).length;
    const concluidas = todosCultivos.flatMap(c=>c.tarefas).filter(t=>t.concluida).length;
    const hoje = new Date();
    const pendentes = todosCultivos.flatMap(c=>c.tarefas).filter(t=>!t.concluida && new Date(t.data)<hoje).length;
    const eficiencia = totalTarefas ? ((concluidas/totalTarefas)*100).toFixed(1) : 0;
    const producao = todosCultivos.reduce((acc,c)=>acc+(parseFloat(c.produtividade)||0),0);
    const custo = todosCultivos.reduce((acc,c)=>acc+(parseFloat(c.custo)||0),0);
    const rent = custo ? (((producao*10 - custo)/custo)*100).toFixed(1) : 0;

    useEffect(()=>{
      const insightsDiv = document.getElementById("insights");
      insightsDiv.innerHTML = `
        <div class='card'>üå± Crescimento m√©dio: <b>${(producao/totalPlantas||0).toFixed(1)}g</b></div>
        <div class='card'>üíß Efici√™ncia: <b>${eficiencia}%</b></div>
        <div class='card'>üìà Rentabilidade m√©dia: <b>${rent}%</b></div>
        <div class='card'>üêõ Ocorr√™ncias registradas: <b>${todosCultivos.filter(c=>c.pragas).length}</b></div>
      `;
    }, [projects]);

    return (
      <>
        <h2>üìà Dashboard Inteligente</h2>
        <div className="dashboard-grid">
          <div className="metric-card"><h3>üåø Cultivos Ativos</h3><div className="metric-value">{totalPlantas}</div></div>
          <div className="metric-card"><h3>‚öôÔ∏è Efici√™ncia Operacional</h3><div className="metric-value">{eficiencia}%</div></div>
          <div className="metric-card"><h3>üí∞ Rentabilidade</h3><div className="metric-value">{rent}%</div></div>
          <div className="metric-card"><h3>üïì Tarefas Pendentes</h3><div className="metric-value">{pendentes}</div></div>
        </div>
      </>
    );
  }

  // === RENDER PRINCIPAL ===
  return (
    <div>
      {page === "dashboard" ? <Dashboard /> : <Projetos />}
      {toast && <div className="toast">{toast}</div>}
    </div>
  );
}

// === APP RAIZ ===
let currentPage = "dashboard";
const root = ReactDOM.createRoot(document.getElementById("root"));
function renderApp() { root.render(<App key={currentPage} page={currentPage} />); }
renderApp();

document.querySelectorAll(".nav-btn").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll(".nav-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    currentPage=btn.getAttribute("data-page");
    renderApp();
  };
});
  </script>
</body>
</html>
