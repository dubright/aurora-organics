<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aurora Organics üå±</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              bg: "#0F1115",
              panel: "#171A1F",
              green: "#00E676",
              lilac: "#C084FC",
              orange: "#FCA311",
              text: "#E6E6E6",
              subt: "#A1A1A1",
            },
          },
        },
      };
    </script>

    <!-- React + Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore-compat.js"></script>

    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.16.2/dist/framer-motion.umd.js"></script>

    <style>
      body {
        background-color: #0F1115;
        color: #E6E6E6;
        font-family: "Inter", sans-serif;
      }
      .card {
        background-color: #171A1F;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,230,118,0.05);
      }
      .blur-bg {
        backdrop-filter: blur(12px);
        background: rgba(0, 230, 118, 0.05);
      }
    </style>
  </head>

  <body class="min-h-screen overflow-x-hidden">
    <div id="root"></div>

    <script type="text/babel">

      // === Firebase Config ===
      const firebaseConfig = {
        apiKey: "AIzaSyD76LM0fFDG0L7tME70GHI5yZS_0KwFP_g",
        authDomain: "aurora-organics-6ffa6.firebaseapp.com",
        projectId: "aurora-organics-6ffa6",
        storageBucket: "aurora-organics-6ffa6.firebasestorage.app",
        messagingSenderId: "878991415647",
        appId: "1:878991415647:web:40e7f5d9811caa9f8c7eea",
        measurementId: "G-8ZLQKFGPW3",
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      // === Dados fixos ===
      const listaPlantas = [
        "Ab√≥bora","Abobrinha","Acelga","Agri√£o","Aipo","Alcachofra","Alface","Alho","Alho-por√≥","Almeir√£o",
        "Aspargo","Batata","Batata-doce","Berinjela","Beterraba","Br√≥colis","Cenoura","Couve","Couve-flor",
        "Ervilha","Espinafre","Feij√£o-vagem","Gengibre","Jil√≥","Maxixe","Milho verde","Moranga","Nabo",
        "Pepino","Pimenta","Piment√£o","Quiabo","Rabanete","Repolho","R√∫cula","Salsa","Taioba","Tomate",
        "Abacate","Abacaxi","Acerola","Amora","Banana","Caju","Goiaba","Jabuticaba","Laranja","Lim√£o",
        "Mam√£o","Manga","Maracuj√°","Melancia","Mel√£o","Morango","P√™ssego","Pitanga","Uva"
      ];

      const fertilizantes = ["BioBizz","Dimy","NPK"];

      // === Fun√ß√µes Firestore ===
      async function salvarCultivo(cultivo) {
        await db.collection("cultivos").add(cultivo);
      }
      async function listarCultivos(setCultivos) {
        const snap = await db.collection("cultivos").get();
        setCultivos(snap.docs.map(d=>({ id:d.id, ...d.data() })));
      }
      async function deletarCultivo(id) {
        await db.collection("cultivos").doc(id).delete();
      }

      // === Componentes ===
      const { motion, AnimatePresence } = window["framer-motion"];

      function AmbientEffect() {
        return (
          <motion.div
            className="absolute inset-0 -z-10 overflow-hidden"
            animate={{ opacity: [0.1, 0.2, 0.1] }}
            transition={{ duration: 10, repeat: Infinity }}
          >
            <div className="bg-gradient-to-br from-green-500/10 via-emerald-300/5 to-lime-400/10 blur-3xl w-full h-full" />
          </motion.div>
        );
      }

      function Header({ tema, setTema }) {
        return (
          <header className="flex justify-between items-center p-4 bg-panel shadow-lg">
            <h1 className="text-green text-xl font-semibold">üå± Aurora Organics</h1>
            <button
              onClick={() => {
                const novo = tema === "dark" ? "light" : "dark";
                setTema(novo);
                localStorage.setItem("tema", novo);
              }}
              className="bg-green text-black px-4 py-2 rounded-full font-semibold hover:opacity-80"
            >
              {tema === "dark" ? "‚òÄÔ∏è Claro" : "üåô Escuro"}
            </button>
          </header>
        );
      }

      function ProgressBar({ percent }) {
        return (
          <div className="w-full bg-gray-700 rounded-full h-2 mt-2">
            <motion.div
              className="h-2 rounded-full bg-green"
              initial={{ width: 0 }}
              animate={{ width: `${percent}%` }}
              transition={{ duration: 1 }}
            ></motion.div>
          </div>
        );
      }
      function CultivoCard({ cultivo, onView, onDelete }) {
        const fases = ["Germina√ß√£o", "Crescimento", "Flora√ß√£o", "Pr√©-colheita"];
        const hoje = new Date();
        const germ = new Date(cultivo.dataGerminacao);
        const diasTotais = cultivo.diasTotais || 60;
        const diasPassados = Math.floor((hoje - germ) / (1000 * 60 * 60 * 24));
        const progresso = Math.min(100, Math.round((diasPassados / diasTotais) * 100));
        const faseAtual =
          diasPassados < 10 ? fases[0] :
          diasPassados < 30 ? fases[1] :
          diasPassados < 45 ? fases[2] : fases[3];

        return (
          <motion.div
            whileHover={{ scale: 1.02 }}
            className="card p-4 flex flex-col justify-between cursor-pointer"
          >
            <div>
              <h2 className="text-lg font-semibold text-green">{cultivo.planta}</h2>
              <p className="text-subt text-sm">{cultivo.fertilizante}</p>
              <p className="mt-1 text-sm">üåø {faseAtual}</p>
              <ProgressBar percent={progresso} />
              <p className="text-xs mt-1">{60 - diasPassados} dias at√© a colheita</p>
            </div>
            <div className="flex gap-2 mt-3">
              <button onClick={onView} className="bg-green text-black px-2 py-1 rounded-md text-sm font-semibold">üîç Ver</button>
              <button onClick={()=>onDelete(cultivo.id)} className="bg-red-500 px-2 py-1 rounded-md text-sm font-semibold">üóëÔ∏è</button>
            </div>
          </motion.div>
        );
      }

      function FormNovoCultivo({ onAdd }) {
        const [planta, setPlanta] = React.useState("");
        const [dataGerminacao, setDataGerminacao] = React.useState("");
        const [fertilizante, setFertilizante] = React.useState("BioBizz");
        const [localCultivo, setLocalCultivo] = React.useState("");

        const handleSubmit = async (e) => {
          e.preventDefault();
          if (!planta || !dataGerminacao) return alert("Preencha todos os campos!");
          const novo = {
            planta,
            dataGerminacao,
            fertilizante,
            localCultivo,
            faseAtual: "Germina√ß√£o",
            diasTotais: 60,
            diasRestantes: 60,
            historico: [],
            anotacoes: "",
            criadoEm: new Date().toISOString(),
          };
          await salvarCultivo(novo);
          onAdd(novo);
          setPlanta("");
          setDataGerminacao("");
          setLocalCultivo("");
          alert("üå± Novo cultivo adicionado com sucesso!");
        };

        return (
          <form onSubmit={handleSubmit} className="card p-4 mb-4">
            <h2 className="text-lg font-semibold mb-2">‚ûï Novo Cultivo</h2>
            <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
              <div>
                <label className="text-sm text-subt">Planta</label>
                <select
                  value={planta}
                  onChange={(e)=>setPlanta(e.target.value)}
                  className="w-full bg-bg text-text border border-green rounded-md p-1"
                >
                  <option value="">Selecione</option>
                  {listaPlantas.map((p,i)=><option key={i}>{p}</option>)}
                </select>
              </div>
              <div>
                <label className="text-sm text-subt">Data de Germina√ß√£o</label>
                <input
                  type="date"
                  value={dataGerminacao}
                  onChange={(e)=>setDataGerminacao(e.target.value)}
                  className="w-full bg-bg text-text border border-green rounded-md p-1"
                />
              </div>
              <div>
                <label className="text-sm text-subt">Fertilizante</label>
                <select
                  value={fertilizante}
                  onChange={(e)=>setFertilizante(e.target.value)}
                  className="w-full bg-bg text-text border border-green rounded-md p-1"
                >
                  {fertilizantes.map((f,i)=><option key={i}>{f}</option>)}
                </select>
              </div>
              <div>
                <label className="text-sm text-subt">Local</label>
                <input
                  type="text"
                  value={localCultivo}
                  onChange={(e)=>setLocalCultivo(e.target.value)}
                  placeholder="ex: Vaso 1"
                  className="w-full bg-bg text-text border border-green rounded-md p-1"
                />
              </div>
            </div>
            <button type="submit" className="mt-4 bg-green text-black px-4 py-2 rounded-md font-semibold hover:opacity-90">
              Salvar
            </button>
          </form>
        );
      }

      function DetalhesCultivo({ cultivo, onClose }) {
        const [historico, setHistorico] = React.useState(cultivo.historico || []);
        const [anotacoes, setAnotacoes] = React.useState(cultivo.anotacoes || "");

        const adicionarEvento = () => {
          const novo = {
            data: new Date().toLocaleDateString("pt-BR"),
            acao: "Aduba√ß√£o",
            detalhe: `Aplicado ${cultivo.fertilizante}`
          };
          setHistorico([...historico, novo]);
        };

        return (
          <motion.div
            initial={{ opacity: 0, y: 50 }}
            animate={{ opacity: 1, y: 0 }}
            className="fixed inset-0 bg-black/70 flex items-center justify-center p-4 z-50"
          >
            <div className="card max-w-lg w-full p-5 relative overflow-y-auto max-h-[90vh]">
              <button onClick={onClose} className="absolute top-2 right-3 text-green text-xl">‚úñ</button>
              <h2 className="text-xl font-semibold mb-2">{cultivo.planta}</h2>
              <p className="text-subt text-sm mb-4">{cultivo.fertilizante}</p>

              <h3 className="text-green font-semibold mb-1">Hist√≥rico</h3>
              <ul className="text-sm mb-2 space-y-1">
                {historico.map((h,i)=>(
                  <li key={i} className="border-b border-green/20 pb-1">{h.data} ‚Äî {h.detalhe}</li>
                ))}
              </ul>

              <button onClick={adicionarEvento} className="bg-green text-black px-3 py-1 rounded-md mb-3">‚úÖ Aplicar fertiliza√ß√£o</button>

              <h3 className="text-green font-semibold mb-1">Anota√ß√µes</h3>
              <textarea
                className="w-full bg-bg text-text border border-green rounded-md p-2"
                rows="4"
                value={anotacoes}
                onChange={(e)=>setAnotacoes(e.target.value)}
              />
            </div>
          </motion.div>
        );
      }
      function App() {
        const [tema, setTema] = React.useState(localStorage.getItem("tema") || "dark");
        const [cultivos, setCultivos] = React.useState([]);
        const [selecionado, setSelecionado] = React.useState(null);

        React.useEffect(() => {
          document.body.className =
            tema === "dark" ? "bg-bg text-text" : "bg-white text-black";
          localStorage.setItem("tema", tema);
          listarCultivos(setCultivos);
        }, [tema]);

        const handleAdd = (novo) => {
          setCultivos((prev) => [...prev, novo]);
        };

        const handleDelete = async (id) => {
          if (confirm("Excluir cultivo permanentemente?")) {
            await deletarCultivo(id);
            listarCultivos(setCultivos);
          }
        };

        return (
          <div className="relative min-h-screen">
            <AmbientEffect />
            <Header tema={tema} setTema={setTema} />

            <main className="p-6 space-y-6 max-w-6xl mx-auto">
              <FormNovoCultivo onAdd={handleAdd} />

              <h2 className="text-xl font-semibold">üåø Seus cultivos ativos</h2>
              {cultivos.length === 0 ? (
                <p className="text-subt text-sm">Nenhum cultivo cadastrado ainda.</p>
              ) : (
                <div className="grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
                  {cultivos.map((c, i) => (
                    <CultivoCard
                      key={c.id || i}
                      cultivo={c}
                      onView={() => setSelecionado(c)}
                      onDelete={handleDelete}
                    />
                  ))}
                </div>
              )}
            </main>

            <AnimatePresence>
              {selecionado && (
                <DetalhesCultivo
                  cultivo={selecionado}
                  onClose={() => setSelecionado(null)}
                />
              )}
            </AnimatePresence>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>

