<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aurora Organics üåø</title>

    <!-- React + Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Fonte -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      /* =================== GERAL =================== */
      body {
        margin: 0;
        font-family: "Inter", sans-serif;
        background: #0e1217;
        color: #e6e6e6;
        display: flex;
        height: 100vh;
        overflow: hidden;
      }

      * {
        box-sizing: border-box;
      }

      /* =================== SIDEBAR =================== */
      .sidebar {
        width: 230px;
        background: #171a1f;
        display: flex;
        flex-direction: column;
        padding: 1.5rem;
        border-right: 1px solid #1f242a;
        box-shadow: 4px 0 10px rgba(0, 0, 0, 0.2);
      }

      .sidebar h2 {
        font-size: 1.3rem;
        color: #00e676;
        margin-bottom: 1.5rem;
        text-align: center;
      }

      .nav-btn {
        background: none;
        border: none;
        color: #a1a1a1;
        text-align: left;
        padding: 10px 12px;
        margin-bottom: 8px;
        font-size: 0.95rem;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.3s;
      }

      .nav-btn:hover,
      .nav-btn.active {
        background: #00e67622;
        color: #00e676;
      }

      /* =================== CONTE√öDO =================== */
      .content {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 1.5rem 2rem;
        overflow-y: auto;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      header h1 {
        font-size: 1.5rem;
        color: #00e676;
      }

      .theme-selector {
        position: relative;
      }

      .theme-selector button {
        background: #00e676;
        border: none;
        color: #000;
        font-weight: 600;
        border-radius: 8px;
        padding: 6px 10px;
        cursor: pointer;
        transition: 0.3s;
      }

      .theme-selector button:hover {
        transform: scale(1.05);
      }

      /* =================== DASHBOARD =================== */
      .dashboard-cards {
        display: flex;
        gap: 1.2rem;
        flex-wrap: wrap;
        margin-bottom: 2rem;
      }

      .card {
        flex: 1;
        min-width: 250px;
        background: #171a1f;
        padding: 1rem;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 230, 118, 0.05);
        transition: 0.3s;
      }

      .card:hover {
        transform: scale(1.02);
      }

      .card h3 {
        color: #00e676;
        margin-bottom: 0.5rem;
      }

      .card p {
        color: #e6e6e6;
        font-size: 1.1rem;
        font-weight: 600;
      }

      /* =================== FORMUL√ÅRIOS =================== */
      .form-group {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      select,
      input {
        background: #1f242a;
        border: 1px solid #2a2f35;
        color: #e6e6e6;
        padding: 8px 10px;
        border-radius: 8px;
        font-family: inherit;
        min-width: 150px;
      }

      button.action {
        background: #00e676;
        border: none;
        color: #000;
        font-weight: 600;
        border-radius: 8px;
        padding: 8px 14px;
        cursor: pointer;
        transition: 0.3s;
      }

      button.action:hover {
        transform: scale(1.05);
      }

      /* =================== TABELAS E LISTAS =================== */
      .list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .item {
        background: #171a1f;
        border: 1px solid #1f242a;
        border-radius: 10px;
        padding: 1rem;
        transition: 0.3s;
      }

      .item:hover {
        transform: scale(1.01);
      }

      .item-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
      }

      .item-header strong {
        color: #00e676;
      }

      .small {
        color: #a1a1a1;
        font-size: 0.85rem;
      }

      /* =================== TOAST =================== */
      .toast {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #00e676;
        color: #000;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 600;
        animation: slideIn 0.5s ease;
      }

      @keyframes slideIn {
        from {
          transform: translateY(50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
    </style>
  </head>

  <body>
    <div class="sidebar">
      <h2>üåø Aurora</h2>
      <button class="nav-btn active" data-page="dashboard">Dashboard</button>
      <button class="nav-btn" data-page="projects">Projetos</button>
      <button class="nav-btn" data-page="tasks">Tarefas</button>
      <button class="nav-btn" data-page="inputs">Insumos</button>
    </div>

    <div class="content">
      <header>
        <h1 id="pageTitle">Dashboard</h1>
        <div class="theme-selector">
          <button id="themeToggle">Alterar Tema</button>
        </div>
      </header>

      <div id="root"></div>
    </div>
    <!-- =================== REACT APP =================== -->
    <script type="text/babel">
      const { useState, useEffect } = React;

      /* =================== DADOS BASE =================== */
      const plantas = [
        "Ab√≥bora","Abobrinha","Acelga","Agri√£o","Aipo","Alface","Batata","Berinjela","Beterraba","Br√≥colis","Cebola",
        "Cenoura","Coentro","Couve","Espinafre","Feij√£o-vagem","Gengibre","Piment√£o","Rabanete","Repolho","R√∫cula",
        "Salsa","Tomate","Uva","Melancia","Morango","Manga","Laranja","Lim√£o","Abacaxi"
      ];
      const fertilizantes = ["BioBizz", "Forth", "Dimy"];

      /* =================== COMPONENTE PRINCIPAL =================== */
      function App() {
        const [page, setPage] = useState("dashboard");
        const [projects, setProjects] = useState(JSON.parse(localStorage.getItem("projects") || "[]"));
        const [toast, setToast] = useState("");

        /* Persist√™ncia */
        useEffect(() => {
          localStorage.setItem("projects", JSON.stringify(projects));
        }, [projects]);

        /* Navega√ß√£o da sidebar */
        useEffect(() => {
          const buttons = document.querySelectorAll(".nav-btn");
          buttons.forEach(btn => {
            btn.classList.toggle("active", btn.dataset.page === page);
          });
          document.getElementById("pageTitle").innerText =
            page.charAt(0).toUpperCase() + page.slice(1);
        }, [page]);

        /* C√°lculos agregados do Dashboard */
        const allCultivos = projects.flatMap(p => p.cultivos);
        const totalQuant = allCultivos.reduce((s, c) => s + Number(c.quantidade || 0), 0);
        const producao = totalQuant * 1.5;
        const custo = totalQuant * 5;
        const lucro = producao * 10;
        const rent = custo > 0 ? (((lucro - custo) / custo) * 100).toFixed(1) : 0;

        /* Fun√ß√µes utilit√°rias */
        const addProject = nome => {
          if (!nome) return;
          const novo = { id: Date.now(), nome, cultivos: [] };
          setProjects([...projects, novo]);
          setToast("üåø Novo projeto criado!");
          setTimeout(() => setToast(""), 2500);
        };

        const deleteProject = id => setProjects(projects.filter(p => p.id !== id));

        const addCultivo = (projId, cultivo) => {
          setProjects(projects.map(p =>
            p.id === projId ? { ...p, cultivos: [...p.cultivos, cultivo] } : p
          ));
          setToast("üå± Cultivo adicionado com sucesso!");
          setTimeout(() => setToast(""), 2500);
        };

        const deleteCultivo = (projId, cultId) => {
          setProjects(projects.map(p =>
            p.id === projId ? { ...p, cultivos: p.cultivos.filter(c => c.id !== cultId) } : p
          ));
        };

        /* =================== TELAS =================== */
        function Dashboard() {
          return (
            <div>
              <div className="dashboard-cards">
                <div className="card">
                  <h3>üåø Cultivos Ativos</h3>
                  <p>{allCultivos.length}</p>
                </div>
                <div className="card">
                  <h3>üì¶ Quantidade Total</h3>
                  <p>{totalQuant}</p>
                </div>
                <div className="card">
                  <h3>‚öôÔ∏è Produ√ß√£o Estimada (kg)</h3>
                  <p>{producao.toFixed(1)}</p>
                </div>
                <div className="card">
                  <h3>üí∞ Lucro Estimado (R$)</h3>
                  <p>{lucro.toFixed(2)}</p>
                </div>
                <div className="card">
                  <h3>üìä Rentabilidade</h3>
                  <p>{rent}%</p>
                </div>
              </div>
              <div className="card">
                <h3>Panorama Geral</h3>
                <p>Atualmente voc√™ possui {projects.length} projetos e {allCultivos.length} cultivos registrados.</p>
              </div>
            </div>
          );
        }

        function Projects() {
          const [nomeProj, setNomeProj] = useState("");
          const [selected, setSelected] = useState(null);
          const [form, setForm] = useState({
            planta: "", data: "", fertilizante: fertilizantes[0],
            litragem: "700ml", quantidade: 1
          });

          const current = projects.find(p => p.id === selected);

          const handleAdd = () => {
            if (!form.planta || !form.data) return alert("Preencha todos os campos!");
            addCultivo(selected, { ...form, id: Date.now() });
            setForm({ planta: "", data: "", fertilizante: fertilizantes[0], litragem: "700ml", quantidade: 1 });
          };

          return (
            <div>
              <div className="form-group">
                <input
                  placeholder="Nome do Projeto"
                  value={nomeProj}
                  onChange={e => setNomeProj(e.target.value)}
                />
                <button className="action" onClick={() => { addProject(nomeProj); setNomeProj(""); }}>
                  + Novo Projeto
                </button>
              </div>

              {projects.length > 0 && (
                <div className="form-group">
                  <select value={selected || ""} onChange={e => setSelected(Number(e.target.value))}>
                    <option value="">Selecione um projeto</option>
                    {projects.map(p => (
                      <option key={p.id} value={p.id}>{p.nome}</option>
                    ))}
                  </select>
                  {selected && (
                    <button className="action" onClick={() => deleteProject(selected)}>üóëÔ∏è Excluir Projeto</button>
                  )}
                </div>
              )}

              {current && (
                <div>
                  <h3>Adicionar Cultivo ‚Äî {current.nome}</h3>
                  <div className="form-group">
                    <select value={form.planta} onChange={e => setForm({ ...form, planta: e.target.value })}>
                      <option value="">Selecione a planta</option>
                      {plantas.map(p => <option key={p}>{p}</option>)}
                    </select>
                    <input type="date" value={form.data} onChange={e => setForm({ ...form, data: e.target.value })} />
                    <select value={form.fertilizante} onChange={e => setForm({ ...form, fertilizante: e.target.value })}>
                      {fertilizantes.map(f => <option key={f}>{f}</option>)}
                    </select>
                    <select value={form.litragem} onChange={e => setForm({ ...form, litragem: e.target.value })}>
                      <option>700ml</option><option>5L</option><option>10L</option><option>15L</option>
                    </select>
                    <input
                      type="number"
                      min="1"
                      placeholder="Quantidade"
                      value={form.quantidade}
                      onChange={e => setForm({ ...form, quantidade: e.target.value })}
                    />
                    <button className="action" onClick={handleAdd}>Adicionar</button>
                  </div>

                  <div className="list">
                    {current.cultivos.map(c => (
                      <div key={c.id} className="item">
                        <div className="item-header">
                          <strong>{c.planta}</strong>
                          <button className="action" onClick={() => deleteCultivo(current.id, c.id)}>Excluir</button>
                        </div>
                        <div className="small">
                          üå± Germina√ß√£o: {new Date(c.data).toLocaleDateString("pt-BR", { day: "2-digit", month: "long" })}
                          <br />üíß Fertilizante: {c.fertilizante} | Litragem: {c.litragem}
                          <br />üì¶ Quantidade: {c.quantidade}
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          );
        }

        function Tasks() {
          return <div className="card"><h3>Tarefas</h3><p>Em breve: gest√£o de tarefas do cultivo üå±</p></div>;
        }

        function Inputs() {
          return <div className="card"><h3>Insumos</h3><p>Em breve: controle de estoque de insumos üíß</p></div>;
        }

        /* =================== RENDER PRINCIPAL =================== */
        return (
          <div>
            {page === "dashboard" && <Dashboard />}
            {page === "projects" && <Projects />}
            {page === "tasks" && <Tasks />}
            {page === "inputs" && <Inputs />}
            {toast && <div className="toast">{toast}</div>}
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);

      /* =================== NAVEGA√á√ÉO SIDEBAR =================== */
      document.querySelectorAll(".nav-btn").forEach(btn =>
        btn.addEventListener("click", () => {
          const page = btn.dataset.page;
          window.appSetPage && window.appSetPage(page);
        })
      );
    </script>

    <script>
      /* Integra a navega√ß√£o React com bot√µes externos */
      window.appSetPage = page => {
        const evt = new CustomEvent("setPage", { detail: page });
        window.dispatchEvent(evt);
      };
    </script>
  </body>
</html>
