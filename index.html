<script>
  const {useState, useEffect} = React;

  const plantas = ["Abóbora","Abobrinha","Acelga","Agrião","Aipo","Alface","Batata","Berinjela","Beterraba","Brócolis","Cebola","Cenoura","Coentro","Couve","Espinafre","Feijão-vagem","Gengibre","Pimentão","Rabanete","Repolho","Rúcula","Salsa","Tomate","Uva","Melancia","Morango","Manga","Laranja","Limão","Abacaxi"];
  const fertRecomendacoes = {
    BioBizz: [
      {fase:"Crescimento",dias:"0–20 dias",recomendacao:"Bio-Grow (2ml/L) + CalMag (1ml/L)"},
      {fase:"Floração",dias:"21–40 dias",recomendacao:"Bio-Bloom (2ml/L) + Top-Max (1ml/L)"},
      {fase:"Pré-colheita",dias:"41–60 dias",recomendacao:"Somente Alg-A-Mic (1ml/L)"}
    ],
    Forth: [
      {fase:"Crescimento",dias:"0–20 dias",recomendacao:"Forth Enraizador (3ml/L) + Forth Cálcio (1ml/L)"},
      {fase:"Floração",dias:"21–40 dias",recomendacao:"Forth Flores (2ml/L) + Forth Potássio (1ml/L)"},
      {fase:"Pré-colheita",dias:"41–60 dias",recomendacao:"Suspender adubação 5 dias antes da colheita"}
    ],
    Dimy: [
      {fase:"Crescimento",dias:"0–20 dias",recomendacao:"Dimy NPK 10-10-10 (2ml/L)"},
      {fase:"Floração",dias:"21–40 dias",recomendacao:"Dimy NPK 4-14-8 (2ml/L)"},
      {fase:"Pré-colheita",dias:"41–60 dias",recomendacao:"Dimy NPK 0-0-30 (1ml/L)"}
    ]
  };

  const fases = [
    {nome:"Germinação",icone:"🌱",cor:"#00ff99",inicio:0,fim:7},
    {nome:"Crescimento",icone:"🌿",cor:"#00E676",inicio:8,fim:35},
    {nome:"Floração",icone:"🌸",cor:"#C084FC",inicio:36,fim:50},
    {nome:"Pré-colheita",icone:"🍅",cor:"#FCA311",inicio:51,fim:60}
  ];

  function getFase(dias){ return fases.find(f=>dias>=f.inicio && dias<=f.fim) || fases[0]; }

  function App(){
    const [cultivos,setCultivos]=useState([]);
    const [planta,setPlanta]=useState("");
    const [data,setData]=useState("");
    const [fert,setFert]=useState("BioBizz");
    const [local,setLocal]=useState("");
    const [toast,setToast]=useState("");
    const [tema,setTema]=useState(localStorage.getItem("tema")||"dark");

    useEffect(()=>{
      const salvo = JSON.parse(localStorage.getItem("cultivos")||"[]");
      const filtrado = salvo.filter(c=>c && c.fertilizante && fertRecomendacoes[c.fertilizante]);
      setCultivos(filtrado);
    },[]);

    useEffect(()=>{ localStorage.setItem("cultivos",JSON.stringify(cultivos)); },[cultivos]);

    useEffect(()=>{
      document.body.style.background = tema==="light"?"#E6E6E6":tema==="green"?"#021d11":"#0F1115";
      document.body.style.color = tema==="light"?"#000":"#E6E6E6";
      localStorage.setItem("tema", tema);
    },[tema]);

    function addCultivo(){
      if(!planta||!data)return alert("Preencha todos os campos!");
      const germ=new Date(data);
      const colh=new Date(germ);colh.setDate(germ.getDate()+60);
      const novo={id:Date.now(),planta,dataGerminacao:data,colheita:colh.toISOString().split("T")[0],fertilizante:fert,localCultivo:local,historico:[],criadoEm:new Date().toLocaleDateString()};
      setCultivos([...cultivos,novo]);
      setPlanta("");setData("");setLocal("");
      setToast("🌱 Cultivo adicionado com sucesso!");setTimeout(()=>setToast(""),3000);
    }

    function excluir(id){setCultivos(cultivos.filter(c=>c.id!==id))}
    function registrar(id,acao){setCultivos(cultivos.map(c=>c.id===id?{...c,historico:[...c.historico,{data:new Date().toLocaleDateString(),acao}]}:c))}
    function diasDesde(germ){return Math.floor((new Date()-new Date(germ))/(1000*60*60*24))}

    return React.createElement("div",{className:"container"},
      React.createElement("h2",null,"🌱 Cadastro de Cultivos"),
      React.createElement("div",{className:"flex"},
        React.createElement("select",{value:planta,onChange:e=>setPlanta(e.target.value)},
          React.createElement("option",{value:""},"Selecione a planta"),
          plantas.map((p,i)=>React.createElement("option",{key:i},p))
        ),
        React.createElement("input",{type:"date",value:data,onChange:e=>setData(e.target.value)}),
        React.createElement("select",{value:fert,onChange:e=>setFert(e.target.value)},
          React.createElement("option",null,"BioBizz"),
          React.createElement("option",null,"Forth"),
          React.createElement("option",null,"Dimy")
        ),
        React.createElement("input",{placeholder:"Local (opcional)",value:local,onChange:e=>setLocal(e.target.value)}),
        React.createElement("button",{onClick:addCultivo},"Adicionar")
      ),
      React.createElement("h2",null,"🌿 Cultivos Ativos"),
      cultivos.map(c=>{
        const dias=diasDesde(c.dataGerminacao);
        const fase=getFase(dias);
        const progresso=Math.min((dias/60)*100,100);
        const fertData=fertRecomendacoes[c.fertilizante]||[];
        return React.createElement("div",{className:"card",key:c.id},
          React.createElement("div",{className:"flex justify-between"},
            React.createElement("strong",null,c.planta),
            React.createElement("span",null,c.fertilizante)
          ),
          React.createElement("small",null,`Germinação: ${c.dataGerminacao} | Colheita: ${c.colheita}`),
          React.createElement("div",{className:"fase",style:{color:fase.cor}},fase.icone," ",fase.nome),
          React.createElement("div",{className:"progress"},
            React.createElement("div",{className:"progress-bar",style:{width:`${progresso}%`,background:fase.cor}})
          ),
          React.createElement("div",{style:{marginTop:"1rem"}},
            React.createElement("strong",null,`💧 Recomendações (${c.fertilizante})`),
            fertData.map((r,i)=>
              React.createElement("div",{key:i},
                React.createElement("strong",null,r.fase)," — ",
                React.createElement("small",null,r.dias),
                React.createElement("div",null,r.recomendacao)
              )
            )
          ),
          React.createElement("div",{className:"flex",style:{marginTop:"1rem"}},
            React.createElement("button",{onClick:()=>registrar(c.id,"Adubação realizada")},"✅ Aplicar"),
            React.createElement("button",{onClick:()=>excluir(c.id)},"🗑️ Excluir")
          ),
          c.historico.length>0 && React.createElement("div",{style:{marginTop:"1rem"}},
            React.createElement("strong",null,"📜 Histórico:"),
            c.historico.map((h,i)=>React.createElement("div",{key:i},
              React.createElement("small",null,`${h.data} — ${h.acao}`)
            ))
          )
        )
      }),
      toast && React.createElement("div",{className:"toast"},toast)
    );
  }

  ReactDOM.render(React.createElement(App), document.getElementById("root"));
</script>
