<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aurora Organics ðŸŒ¿</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Inter", sans-serif;
        background: #0f1115;
        color: #e6e6e6;
        display: flex;
        height: 100vh;
      }
      aside {
        width: 230px;
        background: #121417;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        border-right: 1px solid #1d1f23;
      }
      aside h1 {
        font-size: 1.25rem;
        color: #00e676;
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .nav-btn {
        background: none;
        border: none;
        color: #e6e6e6;
        font-size: 1rem;
        text-align: left;
        padding: 10px;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.3s;
      }
      .nav-btn.active,
      .nav-btn:hover {
        background: #0f271d;
        color: #00e676;
      }
      main {
        flex: 1;
        background: #0f1115;
        overflow-y: auto;
        padding: 2rem;
      }
      h2 {
        color: #00e676;
        margin-top: 0;
      }
      .card {
        background: #171a1f;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        margin-bottom: 1rem;
        box-shadow: 0 4px 12px rgba(0, 230, 118, 0.05);
      }
      .dashboard-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1rem;
      }
      .form-group {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 1rem;
      }
      select,
      input,
      button {
        border: none;
        border-radius: 8px;
        padding: 8px 10px;
        font-family: inherit;
      }
      button.action {
        background: #00e676;
        color: #000;
        font-weight: 600;
        cursor: pointer;
        transition: 0.3s;
      }
      button.action:hover {
        transform: scale(1.03);
      }
      .toast {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #00e676;
        color: #000;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: 600;
        animation: slideIn 0.5s ease;
      }
      @keyframes slideIn {
        from {
          transform: translateY(50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      .small {
        color: #a1a1a1;
        font-size: 0.85rem;
      }
    </style>
  </head>
  <body>
    <div id="root" style="display: flex; width: 100%; height: 100%"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      const plantas = [
        "AbÃ³bora",
        "Abobrinha",
        "Alface",
        "Cenoura",
        "Couve",
        "Tomate",
        "Morango",
        "Uva",
        "Laranja",
        "LimÃ£o",
      ];
      const fertilizantes = ["BioBizz", "Forth", "Dimy"];
      const duracaoCultivo = { Alface: 60, Tomate: 120, Morango: 90 };
      const litragemIdeal = { "700ml": 0.5, "5L": 1.5, "10L": 2.5, "15L": 3.5 };

      function App() {
        const [projects, setProjects] = useState(
          JSON.parse(localStorage.getItem("projects") || "[]")
        );
        const [page, setPage] = useState("dashboard");
        const [toast, setToast] = useState("");
        const [selectedProject, setSelectedProject] = useState(null);

        useEffect(() => {
          localStorage.setItem("projects", JSON.stringify(projects));
        }, [projects]);

        const showToast = (msg) => {
          setToast(msg);
          setTimeout(() => setToast(""), 2500);
        };

        const addProject = (nome) => {
          if (!nome.trim()) return alert("Informe um nome para o projeto.");
          const novo = {
            id: Date.now(),
            nome,
            dataCriacao: new Date().toLocaleDateString(),
            cultivos: [],
          };
          setProjects([...projects, novo]);
          showToast("ðŸŒ¿ Projeto criado!");
        };

        const addCultivo = (projId, form) => {
          const diasTotais = duracaoCultivo[form.planta] || 60;
          const tarefasGeradas = [];
          const dataInicial = new Date(form.data);
          for (let i = 0; i < diasTotais; i += 5) {
            const dataTarefa = new Date(dataInicial.getTime() + i * 86400000);
            tarefasGeradas.push({
              data: dataTarefa.toISOString(),
              tipo: i % 10 === 0 ? "fertilizante" : "Ã¡gua",
              status: "pendente",
              qtdLitros: litragemIdeal[form.litragem] || 1,
            });
          }

          const atualizado = projects.map((p) =>
            p.id === projId
              ? {
                  ...p,
                  cultivos: [
                    ...p.cultivos,
                    { ...form, id: Date.now(), tarefas: tarefasGeradas },
                  ],
                }
              : p
          );
          setProjects(atualizado);
          showToast("ðŸŒ± Cultivo adicionado!");
        };

        function Dashboard() {
          const [selectedId, setSelectedId] = useState(
            selectedProject ? selectedProject.id : ""
          );
          const projeto = projects.find((p) => p.id === Number(selectedId));
          const allCultivos = projeto ? projeto.cultivos : [];
          const totalQ = allCultivos.reduce(
            (a, b) => a + Number(b.quantidade || 0),
            0
          );
          const totalTarefas = allCultivos.flatMap((c) => c.tarefas || []).length;
          const pendentes = allCultivos
            .flatMap((c) => c.tarefas || [])
            .filter((t) => t.status === "pendente");
          const concluidas = totalTarefas - pendentes.length;
          const eficiencia = totalTarefas
            ? ((concluidas / totalTarefas) * 100).toFixed(1)
            : 0;
          const produtividade = totalQ * 1.8;
          const lucro = produtividade * 9.5;
          const hoje = new Date();
          const proximasTarefas = projeto
            ? projeto.cultivos
                .flatMap((c) => c.tarefas || [])
                .filter((t) => {
                  const d = new Date(t.data);
                  const diff = (d - hoje) / 86400000;
                  return diff >= 0 && diff <= 5;
                })
            : [];

          return (
            <>
              <h2>ðŸ“Š Dashboard</h2>
              <div className="form-group">
                <select
                  value={selectedId}
                  onChange={(e) => {
                    const proj = projects.find(
                      (p) => p.id === Number(e.target.value)
                    );
                    setSelectedProject(proj);
                    setSelectedId(e.target.value);
                  }}
                >
                  <option value="">Selecione um projeto</option>
                  {projects.map((p) => (
                    <option key={p.id} value={p.id}>
                      {p.nome}
                    </option>
                  ))}
                </select>
              </div>

              {projeto ? (
                <>
                  <div className="dashboard-cards">
                    <div className="card">
                      <h3>ðŸŒ¿ Cultivos</h3>
                      <p>{allCultivos.length}</p>
                    </div>
                    <div className="card">
                      <h3>ðŸ“¦ Quantidade</h3>
                      <p>{totalQ}</p>
                    </div>
                    <div className="card">
                      <h3>ðŸ’§ EficiÃªncia</h3>
                      <p>{eficiencia}%</p>
                    </div>
                    <div className="card">
                      <h3>ðŸ’° Lucro</h3>
                      <p>R$ {lucro.toFixed(2)}</p>
                    </div>
                  </div>

                  <div className="card">
                    <h3>ðŸ“… PrÃ³ximas Tarefas</h3>
                    {proximasTarefas.length > 0 ? (
                      proximasTarefas.map((t, i) => (
                        <div
                          key={i}
                          style={{
                            color:
                              t.tipo === "fertilizante" ? "#fca311" : "#00e676",
                          }}
                        >
                          {new Date(t.data).toLocaleDateString("pt-BR")} â€” ðŸ’§{" "}
                          {t.tipo} â€” {t.qtdLitros}L
                        </div>
                      ))
                    ) : (
                      <div style={{ opacity: 0.7 }}>
                        Nenhuma tarefa nos prÃ³ximos dias
                      </div>
                    )}
                  </div>
                </>
              ) : (
                <div style={{ opacity: 0.6 }}>
                  Selecione um projeto para visualizar
                </div>
              )}
            </>
          );
        }

        function Projetos() {
          const [nome, setNome] = useState("");
          return (
            <>
              <h2>ðŸŒ¿ Projetos</h2>
              <div className="form-group">
                <input
                  placeholder="Nome do Projeto"
                  value={nome}
                  onChange={(e) => setNome(e.target.value)}
                />
                <button
                  className="action"
                  onClick={() => {
                    addProject(nome);
                    setNome("");
                  }}
                >
                  + Novo Projeto
                </button>
              </div>
              {projects.map((p) => (
                <div key={p.id} className="card">
                  <strong>{p.nome}</strong>
                  <div className="small">
                    {p.cultivos.length} cultivos â€¢ criado em {p.dataCriacao}
                  </div>
                </div>
              ))}
            </>
          );
        }

        return (
          <>
            <aside>
              <h1>ðŸŒ¿ Aurora</h1>
              <button
                className={`nav-btn ${
                  page === "dashboard" ? "active" : ""
                }`}
                onClick={() => setPage("dashboard")}
              >
                Dashboard
              </button>
              <button
                className={`nav-btn ${page === "projects" ? "active" : ""}`}
                onClick={() => setPage("projects")}
              >
                Projetos
              </button>
            </aside>

            <main>
              {page === "dashboard" ? (
                <Dashboard />
              ) : (
                <Projetos />
              )}
            </main>

            {toast && <div className="toast">{toast}</div>}
          </>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
