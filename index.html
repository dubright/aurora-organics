<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aurora Organics üåø</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Inter", sans-serif;
      background: #0f1115;
      color: #e6e6e6;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    aside {
      width: 230px;
      background: #121417;
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    aside h1 {
      font-size: 1.25rem;
      color: #00e676;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .nav-btn {
      background: none;
      border: none;
      color: #e6e6e6;
      font-size: 1rem;
      text-align: left;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }
    .nav-btn.active, .nav-btn:hover {
      background: #0f271d;
      color: #00e676;
    }
    main {
      flex: 1;
      background: #0f1115;
      padding: 2rem;
      overflow-y: auto;
    }
    h2 { color: #00e676; margin-top: 0; }
    .card {
      background: #171a1f;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      margin-bottom: 1rem;
      box-shadow: 0 4px 12px rgba(0, 230, 118, 0.05);
    }
    select, input, button {
      border: none;
      border-radius: 8px;
      padding: 8px 10px;
      font-family: inherit;
    }
    button.action {
      background: #00e676;
      color: #000;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
    }
    button.action:hover { transform: scale(1.03); }
    .form-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 1rem;
    }
    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }
    .progress {
      height: 8px;
      background: #1e2228;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 6px;
    }
    .progress-bar {
      height: 100%;
      transition: width 0.5s ease;
    }
    .small { color: #a1a1a1; font-size: 0.85rem; }
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #00e676;
      color: #000;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      animation: slideIn .5s ease;
    }
    @keyframes slideIn {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
  </style>
</head>
<body>
  <aside>
    <h1>üåø Aurora</h1>
    <button class="nav-btn active" data-page="dashboard">Dashboard</button>
    <button class="nav-btn" data-page="projects">Projetos</button>
  </aside>

  <main id="root"></main>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const plantas = ["Ab√≥bora","Abobrinha","Acelga","Agri√£o","Alface","Batata","Berinjela","Beterraba","Br√≥colis","Cenoura","Coentro","Couve","Espinafre","Piment√£o","Rabanete","Repolho","R√∫cula","Tomate","Uva","Morango","Manga","Laranja","Lim√£o","Abacaxi"];
    const fertilizantes = ["BioBizz","Forth","Dimy"];
    const fases = [
      { nome:"Germina√ß√£o", icone:"üå±", cor:"#00ff99", dias:[0,7] },
      { nome:"Crescimento", icone:"üåø", cor:"#00e676", dias:[8,35] },
      { nome:"Flora√ß√£o", icone:"üå∏", cor:"#c084fc", dias:[36,50] },
      { nome:"Pr√©-colheita", icone:"üçÖ", cor:"#fca311", dias:[51,60] }
    ];

    const getFase = dias => fases.find(f => dias >= f.dias[0] && dias <= f.dias[1]) || fases[0];
    const formatDate = d => new Date(d).toLocaleDateString("pt-BR",{ day:"2-digit", month:"long" });

    function App() {
      const [page, setPage] = useState("dashboard");
      const [projects, setProjects] = useState(JSON.parse(localStorage.getItem("projects") || "[]"));
      const [toast, setToast] = useState("");

      useEffect(() => localStorage.setItem("projects", JSON.stringify(projects)), [projects]);

      const addProject = nome => {
        if (!nome.trim()) return alert("Informe um nome para o projeto.");
        setProjects([...projects, { id: Date.now(), nome, cultivos: [] }]);
        showToast("üåø Projeto criado!");
      };
      const deleteProject = id => setProjects(projects.filter(p => p.id !== id));
      const showToast = msg => { setToast(msg); setTimeout(() => setToast(""), 2500); };

      const addCultivo = (projId, c) => {
        setProjects(projects.map(p =>
          p.id === projId ? { ...p, cultivos: [...p.cultivos, { ...c, id: Date.now(), historico: [] }] } : p
        ));
        showToast("üå± Cultivo adicionado!");
      };
      const deleteCultivo = (projId, cultId) =>
        setProjects(projects.map(p => p.id === projId ? { ...p, cultivos: p.cultivos.filter(c => c.id !== cultId) } : p));
      const registrar = (projId, cultId, acao) => {
        setProjects(projects.map(p =>
          p.id === projId ? {
            ...p,
            cultivos: p.cultivos.map(c => c.id === cultId
              ? { ...c, historico:[...c.historico, { data:new Date().toLocaleDateString(), acao }] }
              : c)
          } : p
        ));
      };

      /* ======= DASHBOARD ======= */
      const all = projects.flatMap(p => p.cultivos);
      const totalQ = all.reduce((a,b) => a + Number(b.quantidade||0), 0);
      const producao = totalQ * 1.5;
      const custo = totalQ * 5;
      const lucro = producao * 10;
      const rent = custo ? (((lucro - custo) / custo) * 100).toFixed(1) : 0;

      function Dashboard() {
        return (
          <>
            <h2>üìä Painel Geral</h2>
            <div className="dashboard-cards">
              <div className="card"><h3>üåø Cultivos Ativos</h3><p>{all.length}</p></div>
              <div className="card"><h3>üì¶ Quantidade Total</h3><p>{totalQ}</p></div>
              <div className="card"><h3>‚öôÔ∏è Produ√ß√£o Estimada</h3><p>{producao.toFixed(1)} kg</p></div>
              <div className="card"><h3>üí∞ Lucro Estimado</h3><p>R$ {lucro.toFixed(2)}</p></div>
              <div className="card"><h3>üìà Rentabilidade</h3><p>{rent}%</p></div>
            </div>
          </>
        );
      }

      function Projetos() {
        const [nome, setNome] = useState("");
        const [sel, setSel] = useState(null);
        const [form, setForm] = useState({ planta:"", data:"", fertilizante:"BioBizz", litragem:"700ml", quantidade:1 });
        const projeto = projects.find(p => p.id === sel);
        const handleAdd = () => {
          if (!form.planta || !form.data) return alert("Preencha todos os campos!");
          addCultivo(sel, form);
          setForm({ planta:"", data:"", fertilizante:"BioBizz", litragem:"700ml", quantidade:1 });
        };

        return (
          <>
            <h2>üåø Projetos</h2>
            <div className="form-group">
              <input placeholder="Nome do Projeto" value={nome} onChange={e=>setNome(e.target.value)}/>
              <button className="action" onClick={()=>{addProject(nome); setNome("");}}>+ Novo Projeto</button>
            </div>

            {projects.length>0 && (
              <div className="form-group">
                <select value={sel||""} onChange={e=>setSel(Number(e.target.value))}>
                  <option value="">Selecione um projeto</option>
                  {projects.map(p=><option key={p.id} value={p.id}>{p.nome}</option>)}
                </select>
                {sel && <button className="action" onClick={()=>deleteProject(sel)}>üóëÔ∏è Excluir Projeto</button>}
              </div>
            )}

            {projeto && (
              <div>
                <div className="form-group">
                  <select value={form.planta} onChange={e=>setForm({...form,planta:e.target.value})}>
                    <option value="">Planta</option>{plantas.map(p=><option key={p}>{p}</option>)}
                  </select>
                  <input type="date" value={form.data} onChange={e=>setForm({...form,data:e.target.value})}/>
                  <select value={form.fertilizante} onChange={e=>setForm({...form,fertilizante:e.target.value})}>
                    {fertilizantes.map(f=><option key={f}>{f}</option>)}
                  </select>
                  <select value={form.litragem} onChange={e=>setForm({...form,litragem:e.target.value})}>
                    <option>700ml</option><option>5L</option><option>10L</option><option>15L</option>
                  </select>
                  <input type="number" min="1" value={form.quantidade} onChange={e=>setForm({...form,quantidade:e.target.value})}/>
                  <button className="action" onClick={handleAdd}>Adicionar</button>
                </div>

                {projeto.cultivos.map(c=>{
                  const dias = Math.floor((new Date()-new Date(c.data))/(1000*60*60*24));
                  const fase = getFase(dias);
                  const prog = Math.min((dias/60)*100,100);
                  return (
                    <div key={c.id} className="card">
                      <div style={{display:"flex",justifyContent:"space-between"}}>
                        <strong>{c.planta}</strong><span>{c.fertilizante}</span>
                      </div>
                      <div className="small">üå± Germina√ß√£o: {formatDate(c.data)} | {fase.icone} {fase.nome}</div>
                      <div className="progress"><div className="progress-bar" style={{width:`${prog}%`,background:fase.cor}}></div></div>
                      <div className="small">üíß Litragem: {c.litragem} | üì¶ Quantidade: {c.quantidade}</div>
                      <div className="form-group">
                        <button className="action" onClick={()=>registrar(projeto.id,c.id,"Aduba√ß√£o realizada")}>‚úÖ Aplicar</button>
                        <button className="action" onClick={()=>deleteCultivo(projeto.id,c.id)}>üóëÔ∏è Excluir</button>
                      </div>
                      {c.historico.length>0 && (
                        <div className="small">
                          <strong>üìú Hist√≥rico:</strong>
                          {c.historico.map((h,i)=><div key={i}>{h.data} ‚Äî {h.acao}</div>)}
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            )}
          </>
        );
      }

      return (
        <div>
          {page==="dashboard"?<Dashboard/>:<Projetos/>}
          {toast && <div className="toast">{toast}</div>}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App/>);

    document.querySelectorAll(".nav-btn").forEach(btn=>{
      btn.onclick=()=>{document.querySelectorAll(".nav-btn").forEach(b=>b.classList.remove("active"));btn.classList.add("active");root.render(<App/>);};
    });
  </script>
</body>
</html>
